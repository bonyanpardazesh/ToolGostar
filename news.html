<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News & Updates - ToolGostar Industrial Group</title>
    <meta name="description" content="Latest news, articles, and updates from ToolGostar Industrial Group, a leader in industrial water treatment solutions.">
    <meta name="keywords" content="industrial water treatment news, company updates, new products, technology articles, ToolGostar">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="public/images/logo/logo1.svg">
    
    <!-- Fonts - Using local Vazir font -->
    <!-- Preload Vazir fonts for better performance -->
    <link rel="preload" href="font/Vazir.woff2" as="font" type="font/woff2">
    <link rel="preload" href="font/Vazir-Bold.woff2" as="font" type="font/woff2">
    <link rel="preload" href="font/Vazir-Medium.woff2" as="font" type="font/woff2">
    <link rel="preload" href="font/Vazir-Light.woff2" as="font" type="font/woff2">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Shared CSS -->
    <link rel="stylesheet" href="shared/css/common.css">
    <link rel="stylesheet" href="shared/css/header.css">
    <link rel="stylesheet" href="shared/css/footer.css">
    
    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="css/news.css">
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="lang-btn" data-lang="en" title="English">
            <img src="https://flagcdn.com/w20/gb.png" alt="English" class="flag-icon">
            <span>EN</span>
        </button>
        <button class="lang-btn" data-lang="fa" title="ŸÅÿßÿ±ÿ≥€å">
            <img src="https://flagcdn.com/w20/ir.png" alt="ŸÅÿßÿ±ÿ≥€å" class="flag-icon">
            <span>ŸÅÿß</span>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <!-- Left side navigation -->
            <ul class="nav-left">
                <li><a href="loading.html" class="nav-link" data-i18n="navigation.home">Home</a></li>
                <li class="nav-dropdown">
                    <a href="products.html" class="nav-link" data-i18n="navigation.products">Products</a>
                    <ul class="dropdown-menu">
                        <li><a href="#" onclick="navigateToProductCategory('water-treatment'); return false;" data-en="Water Treatment Systems" data-fa="ÿ≥€åÿ≥ÿ™ŸÖ‚ÄåŸáÿß€å ÿ™ÿµŸÅ€åŸá ÿ¢ÿ®">Water Treatment Systems</a></li>
                        <li><a href="#" onclick="navigateToProductCategory('mixers'); return false;" data-en="Mixers & Aerators" data-fa="ŸÖÿÆŸÑŸàÿ∑‚Äå⁄©ŸÜ‚ÄåŸáÿß Ÿà ŸáŸàÿßÿØŸá‚ÄåŸáÿß">Mixers & Aerators</a></li>
                        <li><a href="#" onclick="navigateToProductCategory('pumps'); return false;" data-en="Pumps" data-fa="ŸæŸÖŸæ‚ÄåŸáÿß">Pumps</a></li>
                        <li><a href="#" onclick="navigateToProductCategory('filters'); return false;" data-en="Filters" data-fa="ŸÅ€åŸÑÿ™ÿ±Ÿáÿß">Filters</a></li>
                        <li><a href="#" onclick="navigateToProductCategory('control'); return false;" data-en="Control Systems" data-fa="ÿ≥€åÿ≥ÿ™ŸÖ‚ÄåŸáÿß€å ⁄©ŸÜÿ™ÿ±ŸÑ">Control Systems</a></li>
                    </ul>
                </li>
                <li><a href="gallery.html" class="nav-link" data-i18n="navigation.gallery">Executive Records</a></li>
            </ul>
            
            <!-- Center logo -->
            <a href="home.html" class="nav-logo">
                <img src="public/images/logo/logo.png" alt="ToolGostar Industrial Group" />
            </a>
            
            <!-- Right side navigation -->
            <ul class="nav-right">
                <li><a href="about.html" class="nav-link" data-i18n="navigation.about">About</a></li>
                <li><a href="contact.html" class="nav-link" data-i18n="navigation.contact">Contact</a></li>
                <li><a href="news.html" class="nav-link" data-i18n="navigation.news">News</a></li>
            </ul>
            
            <!-- Mobile menu button -->
            <div class="hamburger" id="hamburgerBtn" onclick="toggleMobileMenu()">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <ul class="nav-mobile" id="mobileMenu">
            <li><a href="loading.html" class="nav-link" data-i18n="navigation.home">Home</a></li>
            <li class="nav-dropdown-mobile">
                <a href="products.html" class="nav-link" onclick="toggleMobileDropdown(this); return false;" data-i18n="navigation.products">Products</a>
                <ul class="dropdown-menu-mobile">
                    <li><a href="#" onclick="navigateToProductCategory('water-treatment'); return false;" data-en="Water Treatment Systems" data-fa="ÿ≥€åÿ≥ÿ™ŸÖ‚ÄåŸáÿß€å ÿ™ÿµŸÅ€åŸá ÿ¢ÿ®">Water Treatment Systems</a></li>
                    <li><a href="#" onclick="navigateToProductCategory('mixers'); return false;" data-en="Mixers & Aerators" data-fa="ŸÖÿÆŸÑŸàÿ∑‚Äå⁄©ŸÜ‚ÄåŸáÿß Ÿà ŸáŸàÿßÿØŸá‚ÄåŸáÿß">Mixers & Aerators</a></li>
                    <li><a href="#" onclick="navigateToProductCategory('pumps'); return false;" data-en="Pumps" data-fa="ŸæŸÖŸæ‚ÄåŸáÿß">Pumps</a></li>
                    <li><a href="#" onclick="navigateToProductCategory('filters'); return false;" data-en="Filters" data-fa="ŸÅ€åŸÑÿ™ÿ±Ÿáÿß">Filters</a></li>
                    <li><a href="#" onclick="navigateToProductCategory('control'); return false;" data-en="Control Systems" data-fa="ÿ≥€åÿ≥ÿ™ŸÖ‚ÄåŸáÿß€å ⁄©ŸÜÿ™ÿ±ŸÑ">Control Systems</a></li>
                </ul>
            </li>
            <li><a href="gallery.html" class="nav-link" data-i18n="navigation.gallery">Executive Records</a></li>
            <li><a href="about.html" class="nav-link" data-i18n="navigation.about">About</a></li>
            <li><a href="contact.html" class="nav-link" data-i18n="navigation.contact">Contact</a></li>
            <li><a href="news.html" class="nav-link" data-i18n="navigation.news">News</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-news">
            <div class="container">
                <h1 data-i18n="news.title">News & Updates</h1>
                <p data-i18n="news.subtitle">Stay informed with the latest articles, product announcements, and company news from ToolGostar.</p>
            </div>
        </section>

        <!-- News Content -->
        <section class="news-content">
            <div class="container">
                <!-- News Search -->
                <div class="news-search">
                    <div class="search-container">
                        <input type="text" id="newsSearchInput" placeholder="Search news articles..." class="search-input">
                        <button class="search-btn" onclick="searchNews()">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="clear-search-btn" id="clearNewsSearchBtn" onclick="clearNewsSearch()" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="newsLoading" class="news-loading" style="display: none;">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p data-i18n="news.loading">Loading news articles...</p>
                    </div>
                </div>

                <!-- Error State -->
                <div id="newsError" class="news-error" style="display: none;">
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3 data-i18n="news.error.title">Unable to load news</h3>
                        <p data-i18n="news.error.message">Please check your connection and try again.</p>
                        <button class="btn btn-primary" onclick="location.reload()" data-i18n="news.error.retry">Try Again</button>
                    </div>
                </div>

                <!-- News Grid -->
                <div class="news-grid" id="newsGrid">
                    <!-- News articles will be loaded dynamically from the API -->
                        </div>

                <!-- No News Message -->
                <div id="noNewsMessage" class="no-news-message" style="display: none;">
                    <div class="no-news-content">
                        <i class="fas fa-newspaper"></i>
                        <h3 data-i18n="news.empty.title">No news articles found</h3>
                        <p data-i18n="news.empty.message">No news articles are available at the moment.</p>
                    </div>
                        </div>
                    </div>
        </section>
    </main>

    <!-- News Lightbox -->
    <div class="lightbox" id="newsLightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeNewsLightbox()">&times;</button>
            <div class="news-lightbox-body">
                <div class="news-lightbox-header">
                    <h2 class="news-lightbox-title" id="newsLightboxTitle">Article Title</h2>
                    <div class="news-lightbox-meta" id="newsLightboxMeta">
                        <div class="news-lightbox-meta-item">
                            <i class="fas fa-calendar"></i>
                            <span id="newsLightboxDate">Date</span>
                            </div>
                        </div>
                    </div>
                <div class="news-lightbox-image" id="newsLightboxImage" style="display: none;">
                    <img id="newsLightboxFeaturedImg" src="" alt="" class="news-lightbox-featured-img">
                        </div>
                <div class="news-lightbox-content" id="newsLightboxContent">
                    <!-- Article content will be loaded here -->
                            </div>
                <div class="news-lightbox-tags" id="newsLightboxTags" style="display: none;">
                    <!-- Tags will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ToolGostar Industrial Group</h3>
                    <p>Leading provider of industrial water treatment solutions with a commitment to innovation and excellence.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="products.html">Products</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-map-marker-alt"></i> Tehran, Iran</p>
                    <p><i class="fas fa-phone"></i> 021-22357761-3</p>
                    <p><i class="fas fa-envelope"></i> toolgostar@yahoo.com</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 ToolGostar Industrial Group. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="shared/js/config.js"></script>
    <script src="shared/js/server-config.js"></script>
    <script src="shared/js/common.js"></script>
    <script src="shared/js/api-integration.js"></script>
    <script>
        // News API Integration
        class NewsManager {
            constructor() {
                this.news = [];
                this.categories = [];
                this.allNews = [];
                this.filteredNews = [];
                this.currentSearchTerm = '';
                this.searchTimeout = null;
                this.isLoading = false;
                this.init();
            }

            async init() {
                try {
                    // Load news from API
                    await this.loadNews();
                    await this.loadCategories();
                    this.renderNews();
                    console.log('‚úÖ News manager initialized with API data');
                } catch (error) {
                    console.error('Failed to load news:', error);
                    this.showFallbackContent();
                }
            }

            async loadNews() {
                try {
                    console.log('üîÑ Starting to load news from API...');
                    
                    // Show loading state
                    this.showLoadingState();
                    
                    const response = await fetch(`${window.frontendConfig.getApiBaseUrl()}/news`);
                    console.log('üì° API Response status:', response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('üì° API Response data:', data);
                        
                        // Handle the API response structure
                        if (data.success && data.data && data.data.news) {
                            this.news = data.data.news;
                            this.allNews = [...data.data.news];
                            this.filteredNews = [...data.data.news];
                        console.log('‚úÖ Loaded news from API:', this.news.length, 'articles');
                        } else {
                            this.news = [];
                            this.allNews = [];
                            this.filteredNews = [];
                            console.log('‚ö†Ô∏è No news data in API response');
                        }
                    } else {
                        console.error('‚ùå API Response not OK:', response.status, response.statusText);
                        throw new Error('Failed to fetch news');
                    }
                } catch (error) {
                    console.error('‚ùå Error loading news:', error);
                    this.news = this.getFallbackNews();
                    this.showErrorState();
                    console.log('‚ö†Ô∏è Using fallback news data:', this.news.length, 'articles');
                }
            }

            async loadCategories() {
                try {
                    const response = await fetch(`${window.frontendConfig.getApiBaseUrl()}/news/categories`);
                    if (response.ok) {
                        const data = await response.json();
                        this.categories = data.data.categories || [];
                        console.log('‚úÖ Loaded categories from API:', this.categories.length, 'categories');
                    } else {
                        throw new Error('Failed to fetch categories');
                    }
                } catch (error) {
                    console.error('Error loading categories:', error);
                    // Use fallback categories
                    this.categories = this.getFallbackCategories();
                    console.log('‚ö†Ô∏è Using fallback categories:', this.categories.length, 'categories');
                }
            }

            getFallbackNews() {
                return [];
            }

            getFallbackCategories() {
                return [];
            }

            showLoadingState() {
                const newsContainer = document.querySelector('.news-grid');
                if (newsContainer) {
                    newsContainer.innerHTML = `
                        <div class="news-loading" style="text-align: center; padding: 4rem 2rem;">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #2563eb; margin-bottom: 1rem;"></i>
                                <p data-i18n="news.loading">Loading news articles...</p>
                            </div>
                        </div>
                    `;
                }
            }

            showErrorState() {
                const newsContainer = document.querySelector('.news-grid');
                if (newsContainer) {
                    newsContainer.innerHTML = `
                        <div class="news-error" style="text-align: center; padding: 4rem 2rem; color: #dc2626;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3 data-i18n="news.error.title">Unable to load news</h3>
                            <p data-i18n="news.error.message">Please check your connection and try again.</p>
                            <button class="btn btn-primary" onclick="location.reload()" data-i18n="news.error.retry">Try Again</button>
                        </div>
                    `;
                }
            }

            // Search functionality
            searchNews() {
                const searchInput = document.getElementById('newsSearchInput');
                const searchTerm = searchInput.value.trim().toLowerCase();
                const clearBtn = document.getElementById('clearNewsSearchBtn');
                
                // Clear previous timeout
                if (this.searchTimeout) {
                    clearTimeout(this.searchTimeout);
                }
                
                // Debounce search by 300ms
                this.searchTimeout = setTimeout(() => {
                    this.performSearch(searchTerm, clearBtn);
                }, 300);
            }

            // Actual search function
            performSearch(searchTerm, clearBtn) {
                this.currentSearchTerm = searchTerm;
                
                if (searchTerm === '') {
                    this.clearSearch();
                    return;
                }
                
                // Show clear button
                clearBtn.style.display = 'inline-block';
                
                // Filter news based on search term
                this.filteredNews = this.allNews.filter(article => {
                    const searchFields = [
                        article.title?.en || article.title || '',
                        article.title?.fa || '',
                        article.excerpt?.en || article.excerpt || '',
                        article.excerpt?.fa || '',
                        article.content?.en || article.content || '',
                        article.content?.fa || '',
                        ...(Array.isArray(article.tags) ? article.tags : [])
                    ].join(' ').toLowerCase();
                    
                    return searchFields.includes(searchTerm);
                });
                
                // Update the news array and re-render
                this.news = this.filteredNews;
                this.renderNews();
            }

            clearSearch() {
                this.currentSearchTerm = '';
                this.news = [...this.allNews];
                this.filteredNews = [...this.allNews];
                
                const searchInput = document.getElementById('newsSearchInput');
                const clearBtn = document.getElementById('clearNewsSearchBtn');
                
                if (searchInput) searchInput.value = '';
                if (clearBtn) clearBtn.style.display = 'none';
                
                this.renderNews();
            }

            renderNews() {
                console.log('üé® renderNews called with', this.news.length, 'articles');
                const newsContainer = document.querySelector('.news-grid');
                if (!newsContainer) {
                    console.log('‚ùå News container not found!');
                    return;
                }

                console.log(`üîÑ renderNews called - clearing ${newsContainer.children.length} existing cards`);
                newsContainer.innerHTML = '';

                console.log(`üì∞ Rendering ${this.news.length} news articles`);
                console.log('üì∞ News data:', this.news);
                
                if (this.news.length === 0) {
                    console.log('üì≠ No news articles to display, showing empty state');
                    newsContainer.innerHTML = `
                        <div class="news-empty-state" style="text-align: center; padding: 4rem 2rem; color: #666;">
                            <i class="fas fa-newspaper" style="font-size: 4rem; margin-bottom: 1rem; color: #ddd;"></i>
                            <h3 data-i18n="news.empty.title">No News Articles Available</h3>
                            <p data-i18n="news.empty.message">News articles will appear here once they are published.</p>
                        </div>
                    `;
                    return;
                }
                
                this.news.forEach(article => {
                    const newsCard = this.createNewsCard(article);
                    newsContainer.appendChild(newsCard);
                });
                console.log(`‚úÖ renderNews completed - added ${newsContainer.children.length} cards`);
            }

            // Get current language from i18n system
            getCurrentLanguage() {
                if (window.i18n && window.i18n.currentLanguage) {
                    console.log('üîç getCurrentLanguage: Using i18n.currentLanguage =', window.i18n.currentLanguage);
                    return window.i18n.currentLanguage;
                }
                const storedLang = localStorage.getItem('language') || 'en';
                console.log('üîç getCurrentLanguage: Using localStorage =', storedLang);
                return storedLang;
            }

            // Convert numbers to Farsi format
            convertToFarsiNumbers(text) {
                if (typeof text !== 'string') {
                    text = String(text);
                }
                
                const farsiNumbers = ['€∞', '€±', '€≤', '€≥', '€¥', '€µ', '€∂', '€∑', '€∏', '€π'];
                const englishNumbers = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
                
                for (let i = 0; i < 10; i++) {
                    text = text.replace(new RegExp(englishNumbers[i], 'g'), farsiNumbers[i]);
                }
                
                return text;
            }

            createNewsCard(article) {
                const card = document.createElement('article');
                card.className = 'news-card';
                const currentLang = this.getCurrentLanguage();
                console.log(`üîß Creating news card for article ${article.id} in language: ${currentLang}`);

                const publishedDate = new Date(article.publishedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Get translated content
                console.log(`üîç Article ${article.id} data structure:`, article);
                console.log(`üîç Article ${article.id} title object:`, article.title);
                console.log(`üîç Article ${article.id} excerpt object:`, article.excerpt);
                
                const title = article.title[currentLang] || article.title.en || article.title;
                const excerpt = article.excerpt[currentLang] || article.excerpt.en || article.excerpt;
                const categoryName = article.category?.name ? 
                    (typeof article.category.name === 'object' ? 
                        (article.category.name[currentLang] || article.category.name.en) : 
                        article.category.name) : 
                    this.getCategoryName(article.category?.slug || article.category);
                
                console.log(`üìù Article ${article.id} - Final Title: "${title}"`);
                console.log(`üìù Article ${article.id} - Final Excerpt: "${excerpt.substring(0, 50)}..."`);
                console.log(`üìù Article ${article.id} - Final Category: "${categoryName}"`);
                
                // Convert numbers to Farsi if needed
                const finalTitle = currentLang === 'fa' ? this.convertToFarsiNumbers(title) : title;
                const finalExcerpt = currentLang === 'fa' ? this.convertToFarsiNumbers(excerpt) : excerpt;
                const finalDate = currentLang === 'fa' ? this.convertToFarsiNumbers(publishedDate) : publishedDate;
                
                // Read More button text
                const readMoreText = currentLang === 'fa' ? 'ÿßÿØÿßŸÖŸá ŸÖÿ∑ŸÑÿ®' : 'Read More';
                const readMoreIcon = currentLang === 'fa' ? 'fas fa-arrow-left' : 'fas fa-arrow-right';

                card.innerHTML = `
                    <div class="news-card-image">
                        <img src="${(() => {
                            let imgSrc = article.featuredImage || article.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWpnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';
                            return CommonApp.getImageUrl(imgSrc);
                        })()}" alt="${finalTitle}" loading="lazy">
                        <div class="news-card-category">${categoryName}</div>
                    </div>
                    <div class="news-card-content">
                        <h3 class="news-card-title">${finalTitle}</h3>
                        <p class="news-card-excerpt">${finalExcerpt}</p>
                        <div class="news-card-meta">
                            <span class="news-card-date">
                                <i class="fas fa-calendar"></i> ${finalDate}
                            </span>
                            <span class="news-card-author">
                                <i class="fas fa-user"></i> ${article.author?.firstName ? `${article.author.firstName} ${article.author.lastName}` : 'Editorial Team'}
                            </span>
                        </div>
                        <a href="#" class="news-card-link" onclick="showNewsDetails(${article.id}); return false;">
                            <span class="news-card-link-text">${readMoreText}</span>
                            <i class="${readMoreIcon} news-card-link-icon"></i>
                        </a>
                    </div>
                `;

                return card;
            }

            getCategoryName(categorySlug) {
                const category = this.categories.find(cat => cat.slug === categorySlug);
                const currentLang = this.getCurrentLanguage();
                
                if (category && category.name) {
                    if (typeof category.name === 'object') {
                        return category.name[currentLang] || category.name.en || 'News';
                    }
                    return category.name;
                }
                return currentLang === 'fa' ? 'ÿßÿÆÿ®ÿßÿ±' : 'News';
            }

            showFallbackContent() {
                console.log('Showing empty state for news');
                const newsContainer = document.querySelector('.news-grid');
                if (newsContainer) {
                    newsContainer.innerHTML = `
                        <div class="news-empty-state" style="text-align: center; padding: 4rem 2rem; color: #666;">
                            <i class="fas fa-newspaper" style="font-size: 4rem; margin-bottom: 1rem; color: #ddd;"></i>
                            <h3>No News Articles Available</h3>
                            <p>News articles will appear here once they are published.</p>
                        </div>
                    `;
                }
            }

            formatContent(content) {
                // Simple content formatting - you can enhance this with a proper markdown parser
                return content
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>')
                    .replace(/^/, '<p>')
                    .replace(/$/, '</p>');
            }
        }

        // Make renderNews globally accessible for i18n system
        let newsManager;

        // Embedded translations for news page
        const embeddedNewsTranslations = {
            'news.title': {
                en: 'News & Updates',
                fa: 'ÿßÿÆÿ®ÿßÿ± Ÿà ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å‚ÄåŸáÿß'
            },
            'news.subtitle': {
                en: 'Stay informed with the latest articles, product announcements, and company news from ToolGostar.',
                fa: 'ÿ®ÿß ÿ¢ÿÆÿ±€åŸÜ ŸÖŸÇÿßŸÑÿßÿ™ÿå ÿßÿπŸÑÿßŸÜÿßÿ™ ŸÖÿ≠ÿµŸàŸÑÿßÿ™ Ÿà ÿßÿÆÿ®ÿßÿ± ÿ¥ÿ±⁄©ÿ™ ÿßÿ≤ ÿ∑ŸàŸÑ ⁄Øÿ≥ÿ™ÿ± ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ ÿ®ÿßÿ¥€åÿØ.'
            }
        };

        // Apply embedded translations
        function applyEmbeddedNewsTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            const currentLang = newsManager ? newsManager.getCurrentLanguage() : 'en';
            
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (embeddedNewsTranslations[key]) {
                    el.textContent = embeddedNewsTranslations[key][currentLang] || embeddedNewsTranslations[key].en;
                }
            });
        }

        // Initialize news manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for i18n system to be ready
            const initNewsManager = () => {
                if (window.i18n && window.i18n.initialized) {
                    newsManager = new NewsManager();
                    window.newsManager = newsManager; // Make it globally accessible
                    window.renderNews = () => {
                        if (newsManager) {
                            console.log('üîÑ renderNews called from i18n system');
                            newsManager.renderNews();
                        }
                    };
                    applyEmbeddedNewsTranslations();
                } else {
                    // Retry after a short delay
                    setTimeout(initNewsManager, 100);
                }
            };
            
            initNewsManager();
        });

        // Listen for language changes
        window.addEventListener('languageChanged', (event) => {
            console.log('üîÑ News: Language changed to', event.detail?.language);
            applyEmbeddedNewsTranslations();
            if (newsManager) {
                newsManager.renderNews();
            }
        });

        // Function to show news details in a lightbox
        function showNewsDetails(newsId) {
            console.log('Showing news details for:', newsId);
            
            // Find the article data
            const article = newsManager.news.find(n => n.id === newsId);
            if (!article) {
                console.error('Article not found:', newsId);
                return;
            }
            
            // Get translated content
            const currentLang = newsManager.getCurrentLanguage();
            const title = article.title[currentLang] || article.title.en || article.title;
            const content = article.content[currentLang] || article.content.en || article.content;
            const categoryName = article.category?.name ? 
                (typeof article.category.name === 'object' ? 
                    (article.category.name[currentLang] || article.category.name.en) : 
                    article.category.name) : 
                'News';
            
            const publishedDate = new Date(article.publishedAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Convert numbers to Farsi if needed
            const finalTitle = currentLang === 'fa' ? newsManager.convertToFarsiNumbers(title) : title;
            const finalContent = currentLang === 'fa' ? newsManager.convertToFarsiNumbers(content) : content;
            const finalDate = currentLang === 'fa' ? newsManager.convertToFarsiNumbers(publishedDate) : publishedDate;
            
            // Update lightbox content
            document.getElementById('newsLightboxTitle').textContent = finalTitle;
            document.getElementById('newsLightboxDate').textContent = finalDate;
            
            // Update featured image
            const imageContainer = document.getElementById('newsLightboxImage');
            const featuredImg = document.getElementById('newsLightboxFeaturedImg');
            if (article.featuredImage) {
                let imgSrc = article.featuredImage;
                // Convert to absolute URL (supports both localhost and production)
                featuredImg.src = CommonApp.getImageUrl(imgSrc);
                featuredImg.alt = finalTitle;
                imageContainer.style.display = 'block';
            } else {
                imageContainer.style.display = 'none';
            }
            
            // Update content
            document.getElementById('newsLightboxContent').innerHTML = newsManager.formatContent(finalContent);
            
            // Update tags
            const tagsContainer = document.getElementById('newsLightboxTags');
            console.log('Article tags:', article.tags, 'Type:', typeof article.tags, 'Is Array:', Array.isArray(article.tags));
            
            let tags = article.tags;
            
            // Handle tags that might be stored as JSON string
            if (typeof tags === 'string') {
                try {
                    tags = JSON.parse(tags);
                } catch (e) {
                    console.log('Failed to parse tags JSON:', e);
                    tags = [];
                }
            }
            
            if (tags && Array.isArray(tags) && tags.length > 0) {
                tagsContainer.innerHTML = tags.map(tag => 
                    `<span class="news-lightbox-tag">${tag}</span>`
                ).join('');
                tagsContainer.style.display = 'flex';
            } else {
                tagsContainer.style.display = 'none';
            }
            
            // Show lightbox
            const lightbox = document.getElementById('newsLightbox');
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Function to close the news lightbox
        function closeNewsLightbox() {
            const lightbox = document.getElementById('newsLightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close lightbox on backdrop click
        document.addEventListener('DOMContentLoaded', () => {
            const lightbox = document.getElementById('newsLightbox');
            if (lightbox) {
                lightbox.addEventListener('click', (e) => {
                    if (e.target.id === 'newsLightbox') {
                        closeNewsLightbox();
                    }
                });
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            const lightbox = document.getElementById('newsLightbox');
            if (lightbox && lightbox.classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeNewsLightbox();
                }
            }
        });
    </script>
    <script>
        // Mobile menu toggle function
        function toggleMobileMenu() {
            console.log('üçî Mobile menu toggle called');
            
            const mobileMenu = document.getElementById('mobileMenu');
            const hamburger = document.getElementById('hamburgerBtn') || document.querySelector('.hamburger');
            
            console.log('üçî Mobile menu element:', mobileMenu);
            console.log('üçî Hamburger element:', hamburger);
            
            if (!mobileMenu) {
                console.error('‚ùå Mobile menu not found');
                return;
            }
            
            if (!hamburger) {
                console.error('‚ùå Hamburger button not found');
                return;
            }
            
            const isActive = mobileMenu.classList.contains('active');
            console.log('üçî Current mobile menu state:', isActive);
            
            if (isActive) {
                // Close menu
                mobileMenu.classList.remove('active');
                hamburger.classList.remove('active');
                console.log('üçî Mobile menu closed');
            } else {
                // Open menu
                mobileMenu.classList.add('active');
                hamburger.classList.add('active');
                console.log('üçî Mobile menu opened');
            }
            
            // Force reflow to ensure CSS changes are applied
            mobileMenu.offsetHeight;
            
            // Check final state
            console.log('üçî Final mobile menu state:', mobileMenu.classList.contains('active'));
            console.log('üçî Mobile menu computed style display:', window.getComputedStyle(mobileMenu).display);
            console.log('üçî Mobile menu computed style left:', window.getComputedStyle(mobileMenu).left);
        }
    </script>
    
    <!-- i18n Script -->
    <script src="js/i18n.js"></script>
    
    <!-- Mobile Menu Script -->
    <script>
        // Initialize mobile menu on page load
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            
            if (mobileMenu && hamburger) {
                console.log('üçî Mobile menu elements found and initialized');
                
                // Add click event listener as backup to onclick attribute
                hamburger.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üçî Hamburger clicked via event listener');
                    toggleMobileMenu();
                });
                
                // Also add touch event for mobile devices
                hamburger.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    console.log('üçî Hamburger touched via touch event');
                    toggleMobileMenu();
                });
                
                // Close mobile menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (!mobileMenu.contains(event.target) && !hamburger.contains(event.target)) {
                        if (mobileMenu.classList.contains('active')) {
                            mobileMenu.classList.remove('active');
                            hamburger.classList.remove('active');
                            console.log('üçî Mobile menu closed by outside click');
                        }
                    }
                });
                
                // Close mobile menu when clicking on a link
                const mobileLinks = mobileMenu.querySelectorAll('a');
                mobileLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.classList.remove('active');
                        hamburger.classList.remove('active');
                        console.log('üçî Mobile menu closed by link click');
                    });
                });
            } else {
                console.error('‚ùå Mobile menu elements not found during initialization');
            }
        });

        // Embedded translations for news page
        const embeddedTranslations = {
            'news.loading': {
                en: 'Loading news articles...',
                fa: 'ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ŸÖŸÇÿßŸÑÿßÿ™ ÿÆÿ®ÿ±€å...'
            },
            'news.error.title': {
                en: 'Unable to load news',
                fa: 'ŸÇÿßÿØÿ± ÿ®Ÿá ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿßÿÆÿ®ÿßÿ± ŸÜ€åÿ≥ÿ™'
            },
            'news.error.message': {
                en: 'Please check your connection and try again.',
                fa: 'ŸÑÿ∑ŸÅÿßŸã ÿßÿ™ÿµÿßŸÑ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ÿ±ÿØŸá Ÿà ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.'
            },
            'news.error.retry': {
                en: 'Try Again',
                fa: 'ÿ™ŸÑÿßÿ¥ ŸÖÿ¨ÿØÿØ'
            },
            'news.empty.title': {
                en: 'No News Articles Available',
                fa: 'Ÿá€å⁄Ü ŸÖŸÇÿßŸÑŸá ÿÆÿ®ÿ±€å ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥ ŸÜ€åÿ≥ÿ™'
            },
            'news.empty.message': {
                en: 'News articles will appear here once they are published.',
                fa: 'ŸÖŸÇÿßŸÑÿßÿ™ ÿÆÿ®ÿ±€å Ÿæÿ≥ ÿßÿ≤ ÿßŸÜÿ™ÿ¥ÿßÿ± ÿØÿ± ÿß€åŸÜÿ¨ÿß ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ÿÆŸàÿßŸáŸÜÿØ ÿ¥ÿØ.'
            }
        };

        // Apply embedded translations
        function applyEmbeddedTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            const currentLang = getCurrentLanguage();
            
            elements.forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (embeddedTranslations[key]) {
                    el.textContent = embeddedTranslations[key][currentLang] || embeddedTranslations[key].en;
                }
            });
        }

        // Listen for language changes
        window.addEventListener('languageChanged', (event) => {
            console.log('üîÑ News: Language changed to', event.detail?.language);
            applyEmbeddedTranslations();
        });

        // Global search functions

        window.searchNews = function() {
            if (window.newsManager) {
                window.newsManager.searchNews();
            }
        };

        window.clearNewsSearch = function() {
            if (window.newsManager) {
                window.newsManager.clearSearch();
            }
        };

        // Set up search input event listener
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('newsSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    if (window.newsManager) {
                        window.newsManager.searchNews();
                    }
                });
            }
        });
    </script>
</body>
</html>
